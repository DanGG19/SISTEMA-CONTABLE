{% extends 'contabilidad/base.html' %}

{% block title %}Resumen de Costos ABC{% endblock %}

{% block content %}
<div class="max-w-5xl mx-auto">
    <h2 class="text-3xl font-extrabold text-amber-800 mb-6">ðŸ“Š Resumen de Costos ABC</h2>

    <div class="bg-white p-4 rounded shadow mb-6">
        <form method="get" class="flex flex-wrap gap-4 items-end">
            <label class="flex flex-col text-sm font-semibold text-gray-700">
                AÃ±o:
                <select name="anio" class="border border-gray-300 rounded p-2">
                    <option value="">--Todos--</option>
                    {% for key, value in ANIOS_CHOICES_LIST %}
                    <option value="{{ key }}" {% if anio == key %}selected{% endif %}>{{ value }}</option>
                    {% endfor %}
                </select>
            </label>
            <label class="flex flex-col text-sm font-semibold text-gray-700">
                Mes:
                <select name="mes" class="border border-gray-300 rounded p-2">
                    <option value="">--Todos--</option>
                    {% for key, value in MESES_CHOICES_LIST %}
                    <option value="{{ key }}" {% if mes == key %}selected{% endif %}>{{ value }}</option>
                    {% endfor %}
                </select>
            </label>
            <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Calcular</button>
        </form>
    </div>

    {% if resultados %}
    <div class="bg-white p-4 rounded shadow">
        <h3 class="text-lg font-bold text-amber-800 mb-4">Resumen de Costos ({{ periodo }})</h3>
        <table class="w-full text-sm border-collapse border border-gray-300">
            <thead class="bg-cyan-900 text-white">
                <tr>
                    <th class="border px-3 py-2">Producto</th>
                    <th class="border px-3 py-2 text-right">Cantidad Producida</th>
                    <th class="border px-3 py-2 text-right">Consumo Actividad</th>
                    <th class="border px-3 py-2 text-right">Costo Indirecto</th>
                    <th class="border px-3 py-2 text-right">Mano de Obra</th>
                    <th class="border px-3 py-2 text-right">Materia Prima</th>
                    <th class="border px-3 py-2 text-right">Limpieza/Moldes</th>
                    <th class="border px-3 py-2 text-right">Costo Directo</th>
                    <th class="border px-3 py-2 text-right">Costo Total</th>
                    <th class="border px-3 py-2 text-right">Costo Unitario</th>
                </tr>
            </thead>
            <tbody>
                {% for r in resultados %}
                <tr class="hover:bg-amber-50">
                    <td class="border px-3 py-1">{{ r.producto.nombre }}</td>
                    <td class="border px-3 py-1 text-right">{{ r.cantidad_producida }}</td>
                    <td class="border px-3 py-1 text-right">{{ r.cantidad_consumo|floatformat:2 }}</td>
                    <td class="border px-3 py-1 text-right">{{ r.costo_indirecto|floatformat:2 }}</td>
                    <td class="border px-3 py-1 text-right">{{ r.mano_obra|floatformat:2 }}</td>
                    <td class="border px-3 py-1 text-right">{{ r.materia_prima|floatformat:2 }}</td>
                    <td class="border px-3 py-1 text-right">{{ r.limpieza_moldes|floatformat:2 }}</td>
                    <td class="border px-3 py-1 text-right">{{ r.costo_directo|floatformat:2 }}</td>
                    <td class="border px-3 py-1 text-right font-bold text-amber-800">{{ r.costo_total|floatformat:2 }}</td>
                    <td class="border px-3 py-1 text-right font-bold text-amber-800">{{ r.costo_unitario|floatformat:2 }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="bg-white p-4 rounded shadow text-center text-gray-600">
        No hay datos disponibles para el perÃ­odo seleccionado.
    </div>
    {% endif %}
</div>
{% endblock %}
